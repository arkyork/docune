{% extends "base/base_memo.html" %}
{% load static %}

{% block title %}{{ ref.title }} {% endblock %}

{% block content %}
<h1 class="text-xl font-bold mb-4">{{ ref.title }} </h1>

<!-- å…¨ä½“ã‚’ã¾ã¨ã‚ã¦ x-data ã«ã™ã‚‹ -->
<div x-data="{ showMemo: true, editing: false }">

<!-- ãƒœã‚¿ãƒ³ç¾¤ -->
<div class="flex gap-2 mb-4">
    <button @click="showMemo = !showMemo"
            class="bg-slate-600 text-white px-3  rounded">
    <span x-text="showMemo ? 'ğŸ“ ãƒ¡ãƒ¢ã‚’éš ã™' : 'ğŸ“ ãƒ¡ãƒ¢ã‚’è¡¨ç¤º'"></span>
    </button>
      <template x-if="showMemo">
      <button @click="editing = !editing"
              class="bg-blue-600 text-white px-3  rounded">
          <span x-text="editing ? 'è¡¨ç¤ºã«æˆ»ã™' : 'âœï¸ ãƒ¡ãƒ¢ã‚’ç·¨é›†'"></span>
      </button>
    </template>
    <!-- ğŸ” é¡ä¼¼æ¤œç´¢ãƒœã‚¿ãƒ³ -->
    <div class="">
      <button id="similar-btn"
              class="flex items-center gap-2 bg-indigo-600 text-white font-semibold px-5 py-2.5 rounded-2xl shadow-md transition duration-200 ease-in-out hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2">
        <span>ğŸ”</span>
        <span>é¡ä¼¼æ–‡çŒ®ã‚’æ¢ã™</span>
      </button>
    </div>


</div>

<!-- æ¨ªä¸¦ã³ï¼šPDF ã¨ ãƒ¡ãƒ¢ -->
<div class="flex gap-4 max-h-[90vh] overflow-hidden">
    <!-- å·¦ï¼šPDF -->
    {% if ref.pdf  %}

    <div  class="w-full lg:w-2/3 border rounded overflow-auto max-h-[90vh] max-w-full">
         <iframe src="{{ ref.pdf.url }}" class="w-full h-[90vh]"></iframe>
    </div>
    {% else %}
    <div  class="w-full lg:w-2/3 border rounded overflow-auto max-h-[90vh] max-w-full">
         <iframe src="{{ ref.pdf_url }}" class="w-full h-[90vh]"></iframe>
    </div>
    {% endif %}

    <!-- å³ï¼šãƒ¡ãƒ¢ -->
    <div x-show="showMemo"
         class="w-full lg:w-1/3 border rounded bg-white shadow p-4 overflow-auto max-h-[90vh]">

             <!-- ğŸ“„ é¡ä¼¼æ–‡çŒ®è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="similar-results" class="mt-4 hidden">
      <h2 class="text-lg font-semibold mb-2">ğŸ” é¡ä¼¼æ–‡çŒ®</h2>
      <ul id="similar-list" class="list-disc pl-5 text-sm text-gray-800"></ul>
    </div>
      <h2 class="text-lg font-semibold mb-2">ğŸ“ ãƒ¡ãƒ¢</h2>
  
      <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ -->
      <form method="POST" x-show="editing" class="space-y-4">
        {% csrf_token %}
        <textarea name="memo"
                  class="w-full h-64 border rounded p-2 font-mono resize-y"
                  x-init="$el.focus()">{{ ref.memo }}</textarea>
        <div class="flex justify-end">
          <button type="submit"
                  class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            ğŸ’¾ ä¿å­˜ã™ã‚‹
          </button>
        </div>
      </form>
  
      <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ -->
      <div x-show="!editing" class="prose max-w-none">
        {{ memo_html|safe }}
      </div>
    </div>
  </div>
  




  {% include 'base/pdf.html' %}



{% endblock %}
